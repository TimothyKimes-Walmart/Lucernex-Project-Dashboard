<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{% block title %}Plumbing Dashboard{% endblock %} | Facility Services</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/htmx.org@1.9.10"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            walmart: {
              blue: { 10: '#e5effc', 50: '#80a9f1', 100: '#0053e2', 110: '#004ac9', 130: '#003a9e', 160: '#001e52' },
              spark: { 10: '#fff8e6', 50: '#ffe18f', 100: '#ffc220', 140: '#995213' },
              green: { 10: '#e8f5e3', 100: '#2a8703' },
              red: { 10: '#fde8e6', 100: '#ea1100' },
              gray: { 5: '#f8f8f8', 10: '#f2f2f2', 50: '#cccccc', 100: '#888888', 160: '#2e2e2e' },
            }
          }
        }
      }
    }
  </script>
  <style>
    body { font-family: 'Segoe UI', system-ui, -apple-system, sans-serif; }
    .nav-link { @apply px-4 py-2 rounded-md text-sm font-medium transition-colors; }
    .nav-link:hover { background-color: rgba(255,255,255,0.15); }
    .nav-link.active { background-color: rgba(255,255,255,0.25); font-weight: 700; }
    /* HTMX indicator: hidden by default, shown during request */
    .htmx-indicator { display: none; }
    .htmx-request .htmx-indicator { display: inline-block; }
    .htmx-request .htmx-indicator-hide { display: none; }
    /* Cost redaction mode */
    body.costs-hidden .cost-data { filter: blur(8px); user-select: none; pointer-events: none; }
    body.costs-hidden .cost-chart { filter: blur(12px); user-select: none; pointer-events: none; }
    body.costs-hidden .cost-hide { display: none !important; }
  </style>
</head>
<body class="bg-walmart-gray-5 text-walmart-gray-160 min-h-screen">

  <!-- Top Nav -->
  <nav class="bg-walmart-blue-100 text-white shadow-lg">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
      <div class="flex items-center justify-between h-16">
        <div class="flex items-center space-x-3">
          <span class="text-walmart-spark-100 text-2xl font-bold">‚ú¶</span>
          <span class="text-lg font-bold tracking-tight">Plumbing Projects Dashboard</span>
        </div>
        <div class="flex items-center space-x-2">
          <a href="/" class="nav-link {% if active_page == 'dashboard' %}active{% endif %}"
             aria-label="Dashboard overview">Dashboard</a>
          <a href="/projects" class="nav-link {% if active_page == 'projects' %}active{% endif %}"
             aria-label="All projects list">Projects</a>
          <a href="/pos" class="nav-link {% if active_page == 'pos' %}active{% endif %}"
             aria-label="Purchase orders list">POs</a>
          <!-- Cost Toggle -->
          <div class="ml-4 pl-4 border-l border-white/20 flex items-center gap-2">
            <label for="cost-toggle" class="text-xs text-white/70 cursor-pointer select-none">Costs</label>
            <button id="cost-toggle" onclick="toggleCosts()" role="switch" aria-checked="true"
                    aria-label="Toggle cost visibility"
                    class="relative inline-flex h-5 w-9 items-center rounded-full transition-colors
                           bg-white/30 focus:outline-none focus:ring-2 focus:ring-white/50">
              <span id="cost-toggle-dot"
                    class="inline-block h-3.5 w-3.5 transform rounded-full bg-white shadow transition-transform translate-x-4"></span>
            </button>
            <span id="cost-toggle-label" class="text-xs font-medium text-white/90">ON</span>
          </div>
        </div>
      </div>
    </div>
  </nav>

  <!-- Main Content -->
  <main class="{% if active_page in ('projects', 'pos') %}px-4 sm:px-6 lg:px-8{% else %}max-w-7xl mx-auto px-4 sm:px-6 lg:px-8{% endif %} py-8">
    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer class="bg-white border-t border-walmart-gray-50 mt-12 py-6">
    <div class="max-w-7xl mx-auto px-4 text-center text-walmart-gray-100 text-sm">
      Facility Services ¬∑ Lucernex + SAP Integration ¬∑ Built with üê∂ Code Puppy
    </div>
  </footer>

  <script>
    function toggleCosts() {
      const body = document.body;
      const btn = document.getElementById('cost-toggle');
      const dot = document.getElementById('cost-toggle-dot');
      const label = document.getElementById('cost-toggle-label');
      const hidden = body.classList.toggle('costs-hidden');
      btn.setAttribute('aria-checked', !hidden);
      dot.classList.toggle('translate-x-4', !hidden);
      dot.classList.toggle('translate-x-0.5', hidden);
      btn.classList.toggle('bg-white/30', !hidden);
      btn.classList.toggle('bg-red-400/60', hidden);
      label.textContent = hidden ? 'OFF' : 'ON';
      label.classList.toggle('text-white/90', !hidden);
      label.classList.toggle('text-red-200', hidden);
      // Persist preference in sessionStorage
      sessionStorage.setItem('costsHidden', hidden ? '1' : '0');
    }
    // Restore preference on load
    (function() {
      if (sessionStorage.getItem('costsHidden') === '1') {
        toggleCosts();
      }
    })();
  </script>
  {% block scripts %}{% endblock %}
</body>
</html>
